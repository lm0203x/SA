# Tushare Pro æ•°æ®æ¥å£è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

Tushare Pro æ˜¯ä¸€ä¸ªé‡‘èæ•°æ®å¹³å°ï¼Œæä¾›ä¸°å¯Œçš„è‚¡ç¥¨ã€åŸºé‡‘ã€æœŸè´§ç­‰é‡‘èæ•°æ®æ¥å£ã€‚

**å®˜æ–¹æ–‡æ¡£**: https://tushare.pro/document/2

---

## ğŸ¯ æˆ‘ä»¬ç³»ç»Ÿéœ€è¦çš„æ ¸å¿ƒæ•°æ®

### 1. **è‚¡ç¥¨åˆ—è¡¨æ•°æ®** âœ… å·²å®ç°

**æ¥å£**: `pro.stock_basic()`

**ç”¨é€”**: è·å–æ‰€æœ‰Aè‚¡ä¸Šå¸‚å…¬å¸åŸºæœ¬ä¿¡æ¯

**å‚æ•°**:
```python
df = pro.stock_basic(
    exchange='',        # äº¤æ˜“æ‰€: SSEä¸Šäº¤æ‰€, SZSEæ·±äº¤æ‰€
    list_status='L',    # ä¸Šå¸‚çŠ¶æ€: Lä¸Šå¸‚, Dé€€å¸‚, Pæš‚åœä¸Šå¸‚
    fields='ts_code,symbol,name,area,industry,list_date'
)
```

**è¿”å›å­—æ®µ**:
- `ts_code`: è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ 000001.SZï¼‰
- `symbol`: è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ 000001ï¼‰
- `name`: è‚¡ç¥¨åç§°
- `area`: åœ°åŸŸ
- `industry`: è¡Œä¸š
- `market`: å¸‚åœºç±»å‹ï¼ˆä¸»æ¿/åˆ›ä¸šæ¿/ç§‘åˆ›æ¿ï¼‰
- `list_date`: ä¸Šå¸‚æ—¥æœŸ

**ç¤ºä¾‹è¿”å›**:
```
ts_code    symbol  name    area  industry      list_date
000001.SZ  000001  å¹³å®‰é“¶è¡Œ  æ·±åœ³   é“¶è¡Œ           19910403
000002.SZ  000002  ä¸‡ç§‘A    æ·±åœ³   æˆ¿åœ°äº§         19910129
```

---

### 2. **æ—¥çº¿è¡Œæƒ…æ•°æ®** âœ… å·²å®ç°

**æ¥å£**: `pro.daily()`

**ç”¨é€”**: è·å–è‚¡ç¥¨æ¯æ—¥Kçº¿æ•°æ®

**å‚æ•°**:
```python
df = pro.daily(
    ts_code='000001.SZ',      # è‚¡ç¥¨ä»£ç 
    trade_date='20231201',    # äº¤æ˜“æ—¥æœŸï¼ˆå¯é€‰ï¼‰
    start_date='20231101',    # å¼€å§‹æ—¥æœŸ
    end_date='20231130'       # ç»“æŸæ—¥æœŸ
)
```

**è¿”å›å­—æ®µ**:
- `ts_code`: è‚¡ç¥¨ä»£ç 
- `trade_date`: äº¤æ˜“æ—¥æœŸ
- `open`: å¼€ç›˜ä»·
- `high`: æœ€é«˜ä»·
- `low`: æœ€ä½ä»·
- `close`: æ”¶ç›˜ä»·
- `pre_close`: æ˜¨æ”¶ä»·
- `change`: æ¶¨è·Œé¢
- `pct_chg`: æ¶¨è·Œå¹…ï¼ˆ%ï¼‰
- `vol`: æˆäº¤é‡ï¼ˆæ‰‹ï¼‰
- `amount`: æˆäº¤é¢ï¼ˆåƒå…ƒï¼‰

**æƒé™**: å…è´¹ç”¨æˆ·å¯è·å–è¿‘3å¹´æ—¥çº¿æ•°æ®

---

### 3. **å®æ—¶è¡Œæƒ…æ•°æ®** â³ å¾…å®ç°

**æ¥å£**: `ts.realtime_quote()`

**ç”¨é€”**: è·å–è‚¡ç¥¨å®æ—¶è¡Œæƒ…ï¼ˆåˆ†é’Ÿçº§ï¼‰

**æ³¨æ„**: 
- éœ€è¦è¾ƒé«˜æƒé™ç§¯åˆ†ï¼ˆ2000åˆ†ä»¥ä¸Šï¼‰
- å…è´¹ç”¨æˆ·å¯èƒ½æ— æ³•è®¿é—®
- æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨`pro.daily()`è·å–æœ€æ–°æ—¥çº¿æ•°æ®

**æ›¿ä»£æ–¹æ¡ˆ - æœ€æ–°æ—¥çº¿**:
```python
# è·å–ä»Šå¤©çš„æ•°æ®
df = pro.daily(trade_date='20231201')
```

---

### 4. **åˆ†é’Ÿçº§è¡Œæƒ…æ•°æ®** â³ å¯é€‰

**æ¥å£**: `pro.stk_mins()`

**ç”¨é€”**: è·å–1åˆ†é’Ÿ/5åˆ†é’ŸKçº¿æ•°æ®

**å‚æ•°**:
```python
df = pro.stk_mins(
    ts_code='000001.SZ',
    freq='1min',              # é¢‘ç‡: 1min, 5min, 15min, 30min, 60min
    start_date='20231201',
    end_date='20231201'
)
```

**æƒé™è¦æ±‚**: éœ€è¦5000ç§¯åˆ†ä»¥ä¸Š

**å¯¹äºå…è´¹ç”¨æˆ·**: ä¸å¯ç”¨ï¼Œå»ºè®®ä½¿ç”¨æ—¥çº¿æ•°æ®

---

### 5. **æ¶¨è·Œåœæ•°æ®** ğŸ“Š æ¨è

**æ¥å£**: `pro.limit_list()`

**ç”¨é€”**: è·å–æ¯æ—¥æ¶¨è·Œåœè‚¡ç¥¨ç»Ÿè®¡

**å‚æ•°**:
```python
df = pro.limit_list(
    trade_date='20231201',    # äº¤æ˜“æ—¥æœŸ
    limit_type='U'            # Uæ¶¨åœ, Dè·Œåœ
)
```

**è¿”å›å­—æ®µ**:
- `ts_code`: è‚¡ç¥¨ä»£ç 
- `trade_date`: äº¤æ˜“æ—¥æœŸ
- `industry`: è¡Œä¸š
- `close`: æ”¶ç›˜ä»·
- `pct_chg`: æ¶¨è·Œå¹…
- `limit_times`: æ¶¨åœæ¬¡æ•°

**æƒé™**: å…è´¹ç”¨æˆ·å¯ç”¨

---

### 6. **é¾™è™æ¦œæ•°æ®** ğŸ“Š æ¨è

**æ¥å£**: `pro.top_list()`

**ç”¨é€”**: è·å–æ²ªæ·±é¾™è™æ¦œæ•°æ®

**å‚æ•°**:
```python
df = pro.top_list(
    trade_date='20231201'     # äº¤æ˜“æ—¥æœŸ
)
```

**è¿”å›å­—æ®µ**:
- `ts_code`: è‚¡ç¥¨ä»£ç 
- `name`: è‚¡ç¥¨åç§°
- `close`: æ”¶ç›˜ä»·
- `pct_chg`: æ¶¨è·Œå¹…
- `amount`: é¾™è™æ¦œæˆäº¤é¢
- `net_amount`: é¾™è™æ¦œå‡€ä¹°é¢
- `buy`: é¾™è™æ¦œä¹°å…¥é¢
- `sell`: é¾™è™æ¦œå–å‡ºé¢

**æƒé™**: éœ€è¦120ç§¯åˆ†

---

### 7. **è‚¡ç¥¨æ¯æ—¥æŒ‡æ ‡** ğŸ“ˆ æ¨è

**æ¥å£**: `pro.daily_basic()`

**ç”¨é€”**: è·å–è‚¡ç¥¨æ¯æ—¥é‡è¦åŸºæœ¬æŒ‡æ ‡

**å‚æ•°**:
```python
df = pro.daily_basic(
    ts_code='000001.SZ',      # è‚¡ç¥¨ä»£ç 
    trade_date='20231201'     # äº¤æ˜“æ—¥æœŸ
)
```

**è¿”å›å­—æ®µ**:
- `ts_code`: è‚¡ç¥¨ä»£ç 
- `trade_date`: äº¤æ˜“æ—¥æœŸ
- `close`: æ”¶ç›˜ä»·
- `turnover_rate`: æ¢æ‰‹ç‡ï¼ˆ%ï¼‰
- `turnover_rate_f`: æ¢æ‰‹ç‡ï¼ˆè‡ªç”±æµé€šè‚¡ï¼‰
- `volume_ratio`: é‡æ¯”
- `pe`: å¸‚ç›ˆç‡ï¼ˆæ€»å¸‚å€¼/å‡€åˆ©æ¶¦ï¼‰
- `pe_ttm`: å¸‚ç›ˆç‡ï¼ˆTTMï¼‰
- `pb`: å¸‚å‡€ç‡ï¼ˆæ€»å¸‚å€¼/å‡€èµ„äº§ï¼‰
- `ps`: å¸‚é”€ç‡
- `ps_ttm`: å¸‚é”€ç‡ï¼ˆTTMï¼‰
- `total_share`: æ€»è‚¡æœ¬ï¼ˆä¸‡è‚¡ï¼‰
- `float_share`: æµé€šè‚¡æœ¬ï¼ˆä¸‡è‚¡ï¼‰
- `free_share`: è‡ªç”±æµé€šè‚¡æœ¬ï¼ˆä¸‡è‚¡ï¼‰
- `total_mv`: æ€»å¸‚å€¼ï¼ˆä¸‡å…ƒï¼‰
- `circ_mv`: æµé€šå¸‚å€¼ï¼ˆä¸‡å…ƒï¼‰

**æƒé™**: å…è´¹ç”¨æˆ·å¯ç”¨

**éå¸¸é€‚åˆå¼‚åŠ¨æ£€æµ‹**ï¼š
- æ¢æ‰‹ç‡çªå¢
- é‡æ¯”å¼‚å¸¸
- å¸‚å€¼å˜åŒ–

---

### 8. **èµ„é‡‘æµå‘æ•°æ®** ğŸ’° æ¨è

**æ¥å£**: `pro.moneyflow()`

**ç”¨é€”**: è·å–ä¸ªè‚¡èµ„é‡‘æµå‘

**å‚æ•°**:
```python
df = pro.moneyflow(
    ts_code='000001.SZ',
    start_date='20231101',
    end_date='20231130'
)
```

**è¿”å›å­—æ®µ**:
- `ts_code`: è‚¡ç¥¨ä»£ç 
- `trade_date`: äº¤æ˜“æ—¥æœŸ
- `buy_sm_vol`: å°å•ä¹°å…¥é‡
- `buy_sm_amount`: å°å•ä¹°å…¥é‡‘é¢
- `sell_sm_vol`: å°å•å–å‡ºé‡
- `sell_sm_amount`: å°å•å–å‡ºé‡‘é¢
- `buy_md_vol`: ä¸­å•ä¹°å…¥é‡
- `buy_md_amount`: ä¸­å•ä¹°å…¥é‡‘é¢
- `sell_md_vol`: ä¸­å•å–å‡ºé‡
- `sell_md_amount`: ä¸­å•å–å‡ºé‡‘é¢
- `buy_lg_vol`: å¤§å•ä¹°å…¥é‡
- `buy_lg_amount`: å¤§å•ä¹°å…¥é‡‘é¢
- `sell_lg_vol`: å¤§å•å–å‡ºé‡
- `sell_lg_amount`: å¤§å•å–å‡ºé‡‘é¢
- `buy_elg_vol`: ç‰¹å¤§å•ä¹°å…¥é‡
- `buy_elg_amount`: ç‰¹å¤§å•ä¹°å…¥é‡‘é¢
- `sell_elg_vol`: ç‰¹å¤§å•å–å‡ºé‡
- `sell_elg_amount`: ç‰¹å¤§å•å–å‡ºé‡‘é¢
- `net_mf_vol`: å‡€æµå…¥é‡
- `net_mf_amount`: å‡€æµå…¥é¢

**æƒé™**: éœ€è¦2000ç§¯åˆ†

**å¯¹å¼‚åŠ¨æ£€æµ‹éå¸¸æœ‰ç”¨**ï¼š
- å¤§å•æµå…¥/æµå‡º
- ä¸»åŠ›èµ„é‡‘åŠ¨å‘

---

### 9. **äº¤æ˜“æ—¥å†** ğŸ“… åŸºç¡€

**æ¥å£**: `pro.trade_cal()`

**ç”¨é€”**: è·å–äº¤æ˜“æ‰€æ—¥å†ï¼ˆäº¤æ˜“æ—¥/ä¼‘å¸‚æ—¥ï¼‰

**å‚æ•°**:
```python
df = pro.trade_cal(
    exchange='SSE',           # äº¤æ˜“æ‰€: SSEä¸Šäº¤æ‰€, SZSEæ·±äº¤æ‰€
    start_date='20231101',
    end_date='20231130'
)
```

**è¿”å›å­—æ®µ**:
- `exchange`: äº¤æ˜“æ‰€
- `cal_date`: æ—¥æœŸ
- `is_open`: æ˜¯å¦äº¤æ˜“ï¼ˆ0ä¼‘å¸‚, 1äº¤æ˜“ï¼‰
- `pretrade_date`: ä¸Šä¸€ä¸ªäº¤æ˜“æ—¥

**æƒé™**: å…è´¹ç”¨æˆ·å¯ç”¨

---

## ğŸ”‘ æƒé™è¯´æ˜

Tushare Pro é‡‡ç”¨ç§¯åˆ†åˆ¶åº¦ï¼š

| ç§¯åˆ†ç­‰çº§ | è·å–æ–¹å¼ | å¯ç”¨æ¥å£ |
|---------|---------|---------|
| **0åˆ†ï¼ˆå…è´¹ï¼‰** | æ³¨å†Œå³å¯ | è‚¡ç¥¨åˆ—è¡¨ã€æ—¥çº¿è¡Œæƒ…ã€æ¯æ—¥æŒ‡æ ‡ã€äº¤æ˜“æ—¥å† |
| **120åˆ†** | å®Œå–„èµ„æ–™ã€åˆ†äº« | + é¾™è™æ¦œæ•°æ® |
| **2000åˆ†** | æèµ æˆ–ç§¯ç´¯ | + èµ„é‡‘æµå‘ã€å®æ—¶è¡Œæƒ…ï¼ˆå—é™ï¼‰ |
| **5000åˆ†+** | æèµ  | + åˆ†é’Ÿæ•°æ®ã€tickæ•°æ® |

**è·å–ç§¯åˆ†**:
1. å®Œå–„ä¸ªäººèµ„æ–™ï¼š+50åˆ†
2. æ¯æ—¥ç­¾åˆ°ï¼š+1åˆ†
3. åˆ†äº«åˆ°ç¤¾äº¤åª’ä½“ï¼š+20åˆ†
4. æèµ ï¼š100å…ƒ=2000åˆ†

---

## ğŸ’¡ æ¨èçš„æ•°æ®è·å–æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šå…è´¹ç‰ˆï¼ˆ0ç§¯åˆ†ï¼‰

**å¯ç”¨æ•°æ®**:
- âœ… è‚¡ç¥¨åˆ—è¡¨ (`stock_basic`)
- âœ… æ—¥çº¿è¡Œæƒ… (`daily`)
- âœ… æ¯æ—¥æŒ‡æ ‡ (`daily_basic`) - **æ¨èç”¨äºå¼‚åŠ¨æ£€æµ‹**
- âœ… äº¤æ˜“æ—¥å† (`trade_cal`)

**å¼‚åŠ¨æ£€æµ‹ç­–ç•¥**:
```python
# 1. è·å–æ˜¨å¤©çš„æ•°æ®
df_yesterday = pro.daily_basic(trade_date='20231130')

# 2. è·å–ä»Šå¤©çš„æ•°æ®
df_today = pro.daily_basic(trade_date='20231201')

# 3. è®¡ç®—å¼‚åŠ¨æŒ‡æ ‡
# - æ¢æ‰‹ç‡çªå¢ï¼šä»Šå¤©æ¢æ‰‹ç‡ > æ˜¨å¤©æ¢æ‰‹ç‡ * 2
# - é‡æ¯”å¼‚å¸¸ï¼švolume_ratio > 2
# - ä»·æ ¼å¼‚åŠ¨ï¼špct_chg > 5% æˆ– < -5%
```

**ä¼˜ç‚¹**: å®Œå…¨å…è´¹ï¼Œé€‚åˆä¸ªäººå­¦ä¹ 
**ç¼ºç‚¹**: æ— å®æ—¶æ•°æ®ï¼Œåªèƒ½è·å–æ—¥çº¿çº§åˆ«

---

### æ–¹æ¡ˆäºŒï¼šåŸºç¡€ç‰ˆï¼ˆ120ç§¯åˆ†ï¼‰

**é¢å¤–å¯ç”¨**:
- âœ… é¾™è™æ¦œæ•°æ® (`top_list`) - æ•æ‰ä¸»åŠ›åŠ¨å‘
- âœ… æ¶¨è·Œåœæ•°æ® (`limit_list`)

**å¼‚åŠ¨æ£€æµ‹å¢å¼º**:
- é¾™è™æ¦œå¸­ä½åˆ†æ
- æ¶¨åœæ¿ç›‘æ§

**è·å–æ–¹å¼**: å®Œå–„èµ„æ–™ + åˆ†äº«ï¼Œçº¦1-2å¤©å¯è¾¾åˆ°

---

### æ–¹æ¡ˆä¸‰ï¼šä¸“ä¸šç‰ˆï¼ˆ2000ç§¯åˆ†+ï¼‰

**é¢å¤–å¯ç”¨**:
- âœ… èµ„é‡‘æµå‘ (`moneyflow`) - **æœ€å¼ºå¼‚åŠ¨æ£€æµ‹**
- âœ… å®æ—¶è¡Œæƒ…ï¼ˆå—é™ï¼‰
- âœ… æ›´å¤šè´¢åŠ¡æ•°æ®

**å¼‚åŠ¨æ£€æµ‹**:
- ä¸»åŠ›èµ„é‡‘æµå…¥æµå‡º
- å¤§å•å¼‚åŠ¨
- æ›´ç²¾å‡†çš„é¢„è­¦

**è·å–æ–¹å¼**: æèµ 100å…ƒ

---

## ğŸ“Š æˆ‘ä»¬ç³»ç»Ÿçš„æ•°æ®è·å–å»ºè®®

### é˜¶æ®µä¸€ï¼šåŸºç¡€åŠŸèƒ½ï¼ˆå…è´¹ç‰ˆï¼‰

```python
# 1. è‚¡ç¥¨åˆ—è¡¨ - ç³»ç»Ÿåˆå§‹åŒ–
stocks = pro.stock_basic(list_status='L')

# 2. æ¯æ—¥æ›´æ–°è¡Œæƒ…
daily_data = pro.daily(trade_date='today')
daily_basic = pro.daily_basic(trade_date='today')

# 3. å†å²Kçº¿ï¼ˆç”¨äºå›¾è¡¨å±•ç¤ºï¼‰
history = pro.daily(ts_code='000001.SZ', start_date='20231101', end_date='20231130')

# 4. å¼‚åŠ¨æ£€æµ‹ï¼ˆåŸºäºæ¯æ—¥æŒ‡æ ‡ï¼‰
# - æ¢æ‰‹ç‡ > 10%
# - é‡æ¯” > 2
# - æ¶¨è·Œå¹… > 5%
```

**å¯å®ç°åŠŸèƒ½**:
- âœ… è‚¡ç¥¨åˆ—è¡¨å±•ç¤º
- âœ… Kçº¿å›¾è¡¨
- âœ… åŸºç¡€å¼‚åŠ¨é¢„è­¦
- âœ… ä»·æ ¼é¢„è­¦
- âœ… æ¢æ‰‹ç‡é¢„è­¦

---

### é˜¶æ®µäºŒï¼šå¢å¼ºåŠŸèƒ½ï¼ˆ120ç§¯åˆ†ï¼‰

```python
# 5. é¾™è™æ¦œç›‘æ§
top_list = pro.top_list(trade_date='today')

# 6. æ¶¨åœç›‘æ§
limit_up = pro.limit_list(trade_date='today', limit_type='U')
limit_down = pro.limit_list(trade_date='today', limit_type='D')
```

**æ–°å¢åŠŸèƒ½**:
- âœ… é¾™è™æ¦œå¼‚åŠ¨
- âœ… æ¶¨è·Œåœç»Ÿè®¡
- âœ… ä¸»åŠ›åŠ¨å‘è¿½è¸ª

---

### é˜¶æ®µä¸‰ï¼šä¸“ä¸šåŠŸèƒ½ï¼ˆ2000ç§¯åˆ†+ï¼‰

```python
# 7. èµ„é‡‘æµå‘åˆ†æ
moneyflow = pro.moneyflow(ts_code='000001.SZ', start_date='today')

# 8. å®æ—¶æ•°æ®ï¼ˆå¦‚æœå¯ç”¨ï¼‰
realtime = ts.realtime_quote(ts_code='000001.SZ')
```

**æ–°å¢åŠŸèƒ½**:
- âœ… å¤§å•æµå…¥æµå‡ºé¢„è­¦
- âœ… ä¸»åŠ›èµ„é‡‘å¼‚åŠ¨
- âœ… å®æ—¶ç›‘æ§ï¼ˆå¦‚æœå¯ç”¨ï¼‰

---

## ğŸ¯ æ•°æ®æ›´æ–°é¢‘ç‡

| æ•°æ®ç±»å‹ | æ›´æ–°é¢‘ç‡ | å»ºè®®è·å–é¢‘ç‡ |
|---------|---------|------------|
| è‚¡ç¥¨åˆ—è¡¨ | ä¸å®šæœŸ | æ¯å‘¨1æ¬¡ |
| æ—¥çº¿è¡Œæƒ… | æ¯æ—¥æ”¶ç›˜å | æ¯æ—¥18:00å |
| æ¯æ—¥æŒ‡æ ‡ | æ¯æ—¥æ”¶ç›˜å | æ¯æ—¥18:00å |
| é¾™è™æ¦œ | æ¯æ—¥æ”¶ç›˜å | æ¯æ—¥19:00å |
| èµ„é‡‘æµå‘ | æ¯æ—¥æ”¶ç›˜å | æ¯æ—¥19:00å |

---

## âš ï¸ APIè°ƒç”¨é™åˆ¶

**å…è´¹ç”¨æˆ·**:
- æ¯åˆ†é’Ÿè°ƒç”¨æ¬¡æ•°ï¼š200æ¬¡
- æ¯å°æ—¶è°ƒç”¨æ¬¡æ•°ï¼šä¸é™ï¼ˆä½†å•æ¥å£æœ‰é™åˆ¶ï¼‰
- å•ä¸ªæ¥å£é™åˆ¶ï¼šå¦‚ `stock_basic` æ¯å°æ—¶1æ¬¡

**æ³¨æ„**:
- æµ‹è¯•è¿æ¥æ—¶ä¸è¦é¢‘ç¹è°ƒç”¨
- ä½¿ç”¨æ•°æ®åº“ç¼“å­˜ï¼Œé¿å…é‡å¤è¯·æ±‚
- éµå¾ª"å…ˆç¼“å­˜ï¼Œåè°ƒç”¨"åŸåˆ™

---

## ğŸ’» ä»£ç ç¤ºä¾‹

### å®Œæ•´çš„æ•°æ®è·å–ç¤ºä¾‹

```python
import tushare as ts
from datetime import datetime, timedelta

# åˆå§‹åŒ–
pro = ts.pro_api('YOUR_TOKEN')

# 1. è·å–è‚¡ç¥¨åˆ—è¡¨ï¼ˆæ¯å‘¨æ›´æ–°ä¸€æ¬¡ï¼‰
def get_stock_list():
    df = pro.stock_basic(
        list_status='L',
        fields='ts_code,symbol,name,area,industry,market,list_date'
    )
    return df

# 2. è·å–ä»Šæ—¥è¡Œæƒ…
def get_today_market():
    today = datetime.now().strftime('%Y%m%d')
    df = pro.daily_basic(trade_date=today)
    return df

# 3. å¼‚åŠ¨æ£€æµ‹
def detect_anomaly(df):
    # æ¢æ‰‹ç‡å¼‚åŠ¨
    high_turnover = df[df['turnover_rate'] > 10]
    
    # é‡æ¯”å¼‚åŠ¨
    high_volume_ratio = df[df['volume_ratio'] > 2]
    
    # ä»·æ ¼å¼‚åŠ¨
    price_change = df[(df['close'] > df['close'].shift(1) * 1.05) | 
                      (df['close'] < df['close'].shift(1) * 0.95)]
    
    return {
        'high_turnover': high_turnover,
        'high_volume_ratio': high_volume_ratio,
        'price_change': price_change
    }

# 4. è·å–å†å²Kçº¿
def get_history_kline(ts_code, days=60):
    end_date = datetime.now()
    start_date = end_date - timedelta(days=days)
    
    df = pro.daily(
        ts_code=ts_code,
        start_date=start_date.strftime('%Y%m%d'),
        end_date=end_date.strftime('%Y%m%d')
    )
    return df
```

---

## ğŸ“Œ æ€»ç»“

**æ¨èèµ·æ­¥æ–¹æ¡ˆ**ï¼š
1. **ä½¿ç”¨å…è´¹ç‰ˆ** - å®Œå…¨å¤Ÿç”¨äºå­¦ä¹ å’Œä¸ªäººä½¿ç”¨
2. **é‡ç‚¹ä½¿ç”¨**ï¼š
   - `stock_basic` - è‚¡ç¥¨åˆ—è¡¨
   - `daily` - æ—¥çº¿è¡Œæƒ…
   - `daily_basic` - **æ ¸å¿ƒï¼ç”¨äºå¼‚åŠ¨æ£€æµ‹**
3. **å¼‚åŠ¨æ£€æµ‹æŒ‡æ ‡**ï¼š
   - æ¢æ‰‹ç‡ï¼ˆturnover_rateï¼‰
   - é‡æ¯”ï¼ˆvolume_ratioï¼‰
   - æ¶¨è·Œå¹…ï¼ˆpct_chgï¼‰
   - æˆäº¤é‡ï¼ˆvolï¼‰

**åç»­å‡çº§**ï¼š
- å®Œå–„èµ„æ–™è·å–120ç§¯åˆ† â†’ é¾™è™æ¦œæ•°æ®
- å¦‚éœ€æ›´ä¸“ä¸šåŠŸèƒ½ï¼Œè€ƒè™‘æèµ è·å–2000åˆ†

---

**å®˜æ–¹èµ„æº**:
- å®˜ç½‘: https://tushare.pro
- æ–‡æ¡£: https://tushare.pro/document/2
- ç§¯åˆ†è§„åˆ™: https://tushare.pro/document/1?doc_id=13


# ğŸ“Š æ•°æ®è·å–å®ç°è®¡åˆ’

## ğŸ¯ åŸºäºTushareå…è´¹ç‰ˆçš„å®ç°æ–¹æ¡ˆ

æ ¹æ®Tushareå…è´¹ç‰ˆçš„èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š

---

## âœ… ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ•°æ®ï¼ˆå·²å®Œæˆï¼‰

### 1. æ•°æ®æºé…ç½® âœ…
- [x] Tushare Tokené…ç½®
- [x] è¿æ¥æµ‹è¯•
- [x] æ•°æ®æºæ¿€æ´»

**å·²å®ç°çš„API**:
- `GET /api/datasources` - è·å–æ•°æ®æºåˆ—è¡¨
- `POST /api/datasources/{id}/test` - æµ‹è¯•è¿æ¥
- `PUT /api/datasources/{id}` - æ›´æ–°é…ç½®

---

## ğŸ”„ ç¬¬äºŒé˜¶æ®µï¼šè‚¡ç¥¨åˆ—è¡¨ä¸è¡Œæƒ…ï¼ˆå¾…å®ç°ï¼‰

### 2.1 è‚¡ç¥¨åˆ—è¡¨æ•°æ®

**Tushareæ¥å£**: `pro.stock_basic()`

**åŠŸèƒ½**:
- è·å–æ‰€æœ‰Aè‚¡ä¸Šå¸‚å…¬å¸
- æ”¯æŒæŒ‰è¡Œä¸šç­›é€‰
- æ”¯æŒæŒ‰åœ°åŸŸç­›é€‰
- æ”¯æŒå¸‚åœºç±»å‹ç­›é€‰

**åç«¯éœ€è¦å®ç°**:
```python
# app/services/tushare_service.py
def get_stock_list(self, exchange='', list_status='L', market=''):
    """
    è·å–è‚¡ç¥¨åˆ—è¡¨
    
    å‚æ•°:
        exchange: äº¤æ˜“æ‰€ (SSE/SZSE)
        list_status: ä¸Šå¸‚çŠ¶æ€ (Lä¸Šå¸‚/Dé€€å¸‚/Pæš‚åœ)
        market: å¸‚åœºç±»å‹ (ä¸»æ¿/åˆ›ä¸šæ¿/ç§‘åˆ›æ¿/åŒ—äº¤æ‰€)
    """
    df = self.pro.stock_basic(
        exchange=exchange,
        list_status=list_status,
        market=market,
        fields='ts_code,symbol,name,area,industry,market,list_date'
    )
    return df.to_dict('records')
```

**å‰ç«¯æ¥å£**: å·²å­˜åœ¨
- `GET /api/stocks?industry=é“¶è¡Œ&area=æ·±åœ³`

**å‰ç«¯å±•ç¤º**:
- è‚¡ç¥¨åˆ—è¡¨å¡ç‰‡
- è¡Œä¸šç­›é€‰
- åœ°åŸŸç­›é€‰
- æœç´¢åŠŸèƒ½

---

### 2.2 æ—¥çº¿è¡Œæƒ…æ•°æ®

**Tushareæ¥å£**: `pro.daily()`

**åŠŸèƒ½**:
- è·å–Kçº¿æ•°æ®
- ç”¨äºå›¾è¡¨å±•ç¤º
- å†å²å›æµ‹

**åç«¯éœ€è¦å®ç°**:
```python
# app/services/tushare_service.py
def get_daily_data(self, ts_code, start_date=None, end_date=None, limit=60):
    """
    è·å–æ—¥çº¿è¡Œæƒ…
    
    å‚æ•°:
        ts_code: è‚¡ç¥¨ä»£ç 
        start_date: å¼€å§‹æ—¥æœŸ (YYYYMMDD)
        end_date: ç»“æŸæ—¥æœŸ (YYYYMMDD)
        limit: è¿”å›æœ€è¿‘Nå¤©
    """
    if not start_date and not end_date:
        # å¦‚æœæ²¡æœ‰æŒ‡å®šæ—¥æœŸï¼Œè¿”å›æœ€è¿‘limitå¤©
        end_date = datetime.now().strftime('%Y%m%d')
        start_date = (datetime.now() - timedelta(days=limit*2)).strftime('%Y%m%d')
    
    df = self.pro.daily(
        ts_code=ts_code,
        start_date=start_date,
        end_date=end_date
    )
    return df.to_dict('records')
```

**å‰ç«¯æ¥å£**: å·²å­˜åœ¨
- `GET /api/stocks/{ts_code}/daily?start_date=20231101&end_date=20231130&limit=60`

**å‰ç«¯å±•ç¤º**:
- Kçº¿å›¾è¡¨ï¼ˆRechartsï¼‰
- æˆäº¤é‡æŸ±çŠ¶å›¾
- ç§»åŠ¨å¹³å‡çº¿

---

### 2.3 æ¯æ—¥åŸºæœ¬æŒ‡æ ‡ï¼ˆæ ¸å¿ƒï¼ï¼‰

**Tushareæ¥å£**: `pro.daily_basic()`

**åŠŸèƒ½**:
- æ¢æ‰‹ç‡
- é‡æ¯”
- å¸‚ç›ˆç‡
- å¸‚å€¼
- **æœ€é€‚åˆåšå¼‚åŠ¨æ£€æµ‹**

**åç«¯éœ€è¦å®ç°**:
```python
# app/services/tushare_service.py
def get_daily_basic(self, ts_code=None, trade_date=None):
    """
    è·å–æ¯æ—¥æŒ‡æ ‡
    
    å‚æ•°:
        ts_code: è‚¡ç¥¨ä»£ç ï¼ˆå¯é€‰ï¼Œä¸å¡«è¿”å›æ‰€æœ‰ï¼‰
        trade_date: äº¤æ˜“æ—¥æœŸï¼ˆå¯é€‰ï¼Œé»˜è®¤æœ€æ–°ï¼‰
    """
    if not trade_date:
        trade_date = datetime.now().strftime('%Y%m%d')
    
    df = self.pro.daily_basic(
        ts_code=ts_code,
        trade_date=trade_date,
        fields='ts_code,trade_date,close,turnover_rate,turnover_rate_f,volume_ratio,pe,pe_ttm,pb,ps,total_share,float_share,total_mv,circ_mv'
    )
    return df.to_dict('records')
```

**æ–°å¢å‰ç«¯æ¥å£**:
- `GET /api/stocks/daily-basic?trade_date=20231201` - è·å–å…¨å¸‚åœºæŒ‡æ ‡
- `GET /api/stocks/{ts_code}/basic?trade_date=20231201` - è·å–å•åªè‚¡ç¥¨æŒ‡æ ‡

**å‰ç«¯å±•ç¤º**:
- å®æ—¶ç›‘æ§é¡µé¢
- å¼‚åŠ¨è‚¡ç¥¨åˆ—è¡¨
- æ¢æ‰‹ç‡æ’è¡Œ
- é‡æ¯”æ’è¡Œ

---

## ğŸš¨ ç¬¬ä¸‰é˜¶æ®µï¼šå¼‚åŠ¨æ£€æµ‹ä¸é¢„è­¦ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

### 3.1 å¼‚åŠ¨æ£€æµ‹è§„åˆ™

**åŸºäº `daily_basic` æ•°æ®**:

```python
# app/services/anomaly_detection_service.py
class AnomalyDetectionService:
    
    def detect_high_turnover(self, df, threshold=10):
        """æ¢æ‰‹ç‡å¼‚åŠ¨"""
        return df[df['turnover_rate'] > threshold]
    
    def detect_volume_ratio(self, df, threshold=2):
        """é‡æ¯”å¼‚åŠ¨"""
        return df[df['volume_ratio'] > threshold]
    
    def detect_price_change(self, df, up_threshold=5, down_threshold=-5):
        """ä»·æ ¼å¼‚åŠ¨"""
        # éœ€è¦å¯¹æ¯”å‰ä¸€å¤©çš„æ”¶ç›˜ä»·
        return df[(df['pct_chg'] > up_threshold) | (df['pct_chg'] < down_threshold)]
    
    def detect_market_value_change(self, df, threshold=10):
        """å¸‚å€¼å¼‚åŠ¨"""
        # å¸‚å€¼å¤§å¹…å˜åŒ–
        pass
```

**æ–°å¢APIæ¥å£**:
- `GET /api/anomaly/high-turnover?threshold=10` - é«˜æ¢æ‰‹ç‡
- `GET /api/anomaly/volume-ratio?threshold=2` - é«˜é‡æ¯”
- `GET /api/anomaly/price-change?up=5&down=-5` - ä»·æ ¼å¼‚åŠ¨

**å‰ç«¯å±•ç¤º**:
- å¼‚åŠ¨é¢„è­¦å¡ç‰‡
- å®æ—¶å¼‚åŠ¨åˆ—è¡¨
- å¼‚åŠ¨ç±»å‹åˆ†ç±»ï¼ˆæ¢æ‰‹ç‡/é‡æ¯”/ä»·æ ¼ï¼‰

---

### 3.2 é¢„è­¦è§„åˆ™ç®¡ç†

**å·²æœ‰çš„APIæ¥å£**: âœ…
- `GET /api/rules` - è·å–è§„åˆ™åˆ—è¡¨
- `POST /api/rules` - åˆ›å»ºè§„åˆ™
- `PUT /api/rules/{id}` - æ›´æ–°è§„åˆ™
- `DELETE /api/rules/{id}` - åˆ é™¤è§„åˆ™
- `GET /api/alerts` - è·å–é¢„è­¦è®°å½•

**éœ€è¦å®ç°åç«¯é€»è¾‘**:
```python
# app/services/alert_service.py
class AlertService:
    
    def check_rules(self, stock_data, rules):
        """æ£€æŸ¥è‚¡ç¥¨æ•°æ®æ˜¯å¦è§¦å‘è§„åˆ™"""
        alerts = []
        
        for rule in rules:
            if not rule.enabled:
                continue
            
            if rule.rule_type == 'price_change':
                # æ£€æŸ¥æ¶¨è·Œå¹…
                if self._check_price_change(stock_data, rule):
                    alerts.append(self._create_alert(stock_data, rule))
            
            elif rule.rule_type == 'volume_spike':
                # æ£€æŸ¥æˆäº¤é‡å¼‚åŠ¨
                if self._check_volume_spike(stock_data, rule):
                    alerts.append(self._create_alert(stock_data, rule))
            
            elif rule.rule_type == 'turnover_rate':
                # æ£€æŸ¥æ¢æ‰‹ç‡
                if self._check_turnover_rate(stock_data, rule):
                    alerts.append(self._create_alert(stock_data, rule))
        
        return alerts
```

**å‰ç«¯å±•ç¤º**:
- è§„åˆ™é…ç½®è¡¨å•
- è§„åˆ™åˆ—è¡¨
- å¯ç”¨/ç¦ç”¨å¼€å…³
- é¢„è­¦å†å²è®°å½•

---

## ğŸ“ˆ ç¬¬å››é˜¶æ®µï¼šæ•°æ®å¯è§†åŒ–

### 4.1 Kçº¿å›¾è¡¨

**æ•°æ®æ¥æº**: `pro.daily()`

**å›¾è¡¨ç»„ä»¶**: Recharts

**åŠŸèƒ½**:
- æ—¥Kçº¿/å‘¨Kçº¿/æœˆKçº¿åˆ‡æ¢
- MACDæŒ‡æ ‡
- KDJæŒ‡æ ‡
- æˆäº¤é‡
- ç§»åŠ¨å¹³å‡çº¿ï¼ˆMA5/MA10/MA20ï¼‰

**å‰ç«¯å®ç°**:
```jsx
// src/components/StockChart.jsx
import { LineChart, Line, CandlestickChart } from 'recharts';

function StockChart({ tsCode }) {
  const [klineData, setKlineData] = useState([]);
  
  useEffect(() => {
    // è·å–Kçº¿æ•°æ®
    getStockDailyData(tsCode, { limit: 60 }).then(data => {
      setKlineData(data);
    });
  }, [tsCode]);
  
  return (
    <ResponsiveContainer>
      <LineChart data={klineData}>
        <Line dataKey="close" stroke="#8884d8" />
        <Line dataKey="ma5" stroke="#82ca9d" />
        <Line dataKey="ma10" stroke="#ffc658" />
      </LineChart>
    </ResponsiveContainer>
  );
}
```

---

### 4.2 å®æ—¶ç›‘æ§é¢æ¿

**æ•°æ®æ¥æº**: `pro.daily_basic()`

**æ›´æ–°é¢‘ç‡**: æ¯æ—¥æ”¶ç›˜åï¼ˆ18:00åï¼‰

**å±•ç¤ºå†…å®¹**:
- æ¶¨å¹…æ¦œ Top 10
- è·Œå¹…æ¦œ Top 10
- æ¢æ‰‹ç‡æ¦œ Top 10
- æˆäº¤é¢æ¦œ Top 10
- å¼‚åŠ¨è‚¡ç¥¨åˆ—è¡¨

---

## ğŸ”„ ç¬¬äº”é˜¶æ®µï¼šå®šæ—¶ä»»åŠ¡

### 5.1 æ•°æ®æ›´æ–°ä»»åŠ¡

**ä½¿ç”¨APSchedulerå®šæ—¶ä»»åŠ¡**:

```python
# app/tasks/data_update.py
from apscheduler.schedulers.background import BackgroundScheduler

scheduler = BackgroundScheduler()

@scheduler.scheduled_job('cron', hour=18, minute=30)
def update_daily_data():
    """æ¯æ—¥18:30æ›´æ–°æ•°æ®"""
    logger.info("å¼€å§‹æ›´æ–°æ¯æ—¥æ•°æ®...")
    
    # 1. è·å–äº¤æ˜“æ—¥å†ï¼Œåˆ¤æ–­ä»Šå¤©æ˜¯å¦äº¤æ˜“æ—¥
    trade_cal = tushare_service.get_trade_cal()
    if not is_trading_day(trade_cal):
        logger.info("ä»Šæ—¥éäº¤æ˜“æ—¥ï¼Œè·³è¿‡æ›´æ–°")
        return
    
    # 2. æ›´æ–°è‚¡ç¥¨åˆ—è¡¨ï¼ˆæ¯å‘¨ä¸€æ¬¡ï¼‰
    if datetime.now().weekday() == 0:
        update_stock_list()
    
    # 3. æ›´æ–°æ¯æ—¥è¡Œæƒ…
    daily_data = tushare_service.get_daily_basic()
    save_to_database(daily_data)
    
    # 4. æ‰§è¡Œå¼‚åŠ¨æ£€æµ‹
    anomalies = detect_anomalies(daily_data)
    
    # 5. æ£€æŸ¥é¢„è­¦è§„åˆ™
    check_alert_rules(anomalies)
    
    logger.info("æ¯æ—¥æ•°æ®æ›´æ–°å®Œæˆ")

scheduler.start()
```

---

## ğŸ“Š æ•°æ®å­˜å‚¨ç­–ç•¥

### 6.1 æ•°æ®åº“è¡¨è®¾è®¡

```sql
-- è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯è¡¨
CREATE TABLE stocks (
    id INT PRIMARY KEY AUTO_INCREMENT,
    ts_code VARCHAR(10) UNIQUE,
    symbol VARCHAR(10),
    name VARCHAR(50),
    area VARCHAR(10),
    industry VARCHAR(20),
    market VARCHAR(10),
    list_date DATE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- æ—¥çº¿è¡Œæƒ…è¡¨
CREATE TABLE stock_daily (
    id INT PRIMARY KEY AUTO_INCREMENT,
    ts_code VARCHAR(10),
    trade_date DATE,
    open DECIMAL(10,2),
    high DECIMAL(10,2),
    low DECIMAL(10,2),
    close DECIMAL(10,2),
    pre_close DECIMAL(10,2),
    change_amount DECIMAL(10,2),
    pct_chg DECIMAL(6,2),
    vol BIGINT,
    amount DECIMAL(15,2),
    INDEX idx_ts_code_date (ts_code, trade_date)
);

-- æ¯æ—¥æŒ‡æ ‡è¡¨
CREATE TABLE stock_daily_basic (
    id INT PRIMARY KEY AUTO_INCREMENT,
    ts_code VARCHAR(10),
    trade_date DATE,
    close DECIMAL(10,2),
    turnover_rate DECIMAL(6,2),
    volume_ratio DECIMAL(6,2),
    pe DECIMAL(10,2),
    pb DECIMAL(10,2),
    total_mv DECIMAL(15,2),
    circ_mv DECIMAL(15,2),
    INDEX idx_ts_code_date (ts_code, trade_date)
);

-- å¼‚åŠ¨è®°å½•è¡¨
CREATE TABLE anomaly_records (
    id INT PRIMARY KEY AUTO_INCREMENT,
    ts_code VARCHAR(10),
    anomaly_type VARCHAR(20),
    trade_date DATE,
    metric_value DECIMAL(10,2),
    threshold_value DECIMAL(10,2),
    severity VARCHAR(10),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## ğŸ¯ å®ç°ä¼˜å…ˆçº§

### P0 - ç«‹å³å®ç°ï¼ˆæœ¬å‘¨ï¼‰
1. âœ… æ•°æ®æºé…ç½®ï¼ˆå·²å®Œæˆï¼‰
2. ğŸ”„ è‚¡ç¥¨åˆ—è¡¨è·å–
3. ğŸ”„ æ—¥çº¿è¡Œæƒ…è·å–
4. ğŸ”„ å‰ç«¯Kçº¿å›¾è¡¨å±•ç¤º

### P1 - çŸ­æœŸå®ç°ï¼ˆä¸‹å‘¨ï¼‰
1. æ¯æ—¥æŒ‡æ ‡è·å–
2. å¼‚åŠ¨æ£€æµ‹é€»è¾‘
3. é¢„è­¦è§„åˆ™ç®¡ç†
4. å®æ—¶ç›‘æ§é¢æ¿

### P2 - ä¸­æœŸå®ç°ï¼ˆä¸‹ä¸‹å‘¨ï¼‰
1. å®šæ—¶ä»»åŠ¡
2. æ•°æ®åº“å­˜å‚¨
3. å†å²æ•°æ®å›æµ‹
4. WebSocketå®æ—¶æ¨é€

### P3 - é•¿æœŸå®ç°ï¼ˆä¸€ä¸ªæœˆå†…ï¼‰
1. æ›´å¤šæŠ€æœ¯æŒ‡æ ‡
2. è‡ªå®šä¹‰ç­–ç•¥
3. å›æµ‹ç³»ç»Ÿ
4. æŠ¥è¡¨å¯¼å‡º

---

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹

### APIè°ƒç”¨é¢‘ç‡æ§åˆ¶
```python
import time
from functools import wraps

def rate_limit(calls_per_minute=60):
    """APIè°ƒç”¨é¢‘ç‡é™åˆ¶è£…é¥°å™¨"""
    min_interval = 60.0 / calls_per_minute
    last_called = [0.0]
    
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            elapsed = time.time() - last_called[0]
            left_to_wait = min_interval - elapsed
            if left_to_wait > 0:
                time.sleep(left_to_wait)
            ret = func(*args, **kwargs)
            last_called[0] = time.time()
            return ret
        return wrapper
    return decorator

@rate_limit(calls_per_minute=60)
def get_stock_data(ts_code):
    return tushare_service.get_stock_basic()
```

### æ•°æ®ç¼“å­˜ç­–ç•¥
```python
from functools import lru_cache
from datetime import datetime, timedelta

@lru_cache(maxsize=100)
def get_stock_list_cached():
    """ç¼“å­˜è‚¡ç¥¨åˆ—è¡¨ï¼Œæ¯å¤©æ›´æ–°ä¸€æ¬¡"""
    return tushare_service.get_stock_list()

# Redisç¼“å­˜
def get_daily_data_with_cache(ts_code, trade_date):
    cache_key = f"daily:{ts_code}:{trade_date}"
    
    # å…ˆä»ç¼“å­˜è·å–
    cached_data = redis_client.get(cache_key)
    if cached_data:
        return json.loads(cached_data)
    
    # ç¼“å­˜æœªå‘½ä¸­ï¼Œä»Tushareè·å–
    data = tushare_service.get_daily_data(ts_code, trade_date)
    
    # å­˜å…¥ç¼“å­˜ï¼Œä¿å­˜24å°æ—¶
    redis_client.setex(cache_key, 86400, json.dumps(data))
    
    return data
```

---

## ğŸ“ æ€»ç»“

**å…è´¹ç‰ˆTushareå®Œå…¨å¯ä»¥å®ç°**:
- âœ… è‚¡ç¥¨åˆ—è¡¨ç®¡ç†
- âœ… æ—¥çº¿Kçº¿å›¾è¡¨
- âœ… å¼‚åŠ¨æ£€æµ‹ï¼ˆæ¢æ‰‹ç‡ã€é‡æ¯”ã€æ¶¨è·Œå¹…ï¼‰
- âœ… é¢„è­¦è§„åˆ™ç®¡ç†
- âœ… å†å²æ•°æ®å›æµ‹

**é™åˆ¶**:
- âŒ æ— å®æ—¶è¡Œæƒ…ï¼ˆåªæœ‰æ—¥çº¿çº§åˆ«ï¼‰
- âŒ æ— åˆ†é’Ÿæ•°æ®
- âŒ æ— èµ„é‡‘æµå‘æ•°æ®ï¼ˆéœ€è¦2000ç§¯åˆ†ï¼‰

**æ¨èä½¿ç”¨ç­–ç•¥**:
1. æ¯æ—¥æ”¶ç›˜åï¼ˆ18:00-19:00ï¼‰æ‰¹é‡æ›´æ–°æ•°æ®
2. ä½¿ç”¨Redisç¼“å­˜å‡å°‘APIè°ƒç”¨
3. æ•°æ®åº“å­˜å‚¨å†å²æ•°æ®
4. å‰ç«¯å±•ç¤ºç¼“å­˜æ•°æ®ï¼Œæå‡å“åº”é€Ÿåº¦

---

**æ¥ä¸‹æ¥çš„å·¥ä½œ**:
1. å®ç°è‚¡ç¥¨åˆ—è¡¨API
2. å®ç°æ—¥çº¿è¡Œæƒ…API
3. å‰ç«¯å¯¹æ¥è¿™äº›API
4. å®ç°Kçº¿å›¾è¡¨ç»„ä»¶


# ğŸ“¦ æ•°æ®ç¼“å­˜æ–¹æ¡ˆè¯´æ˜

## ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®ç¼“å­˜ï¼Ÿ

**Tushareå…è´¹ç‰ˆé™åˆ¶**ï¼š
- `stock_basic` æ¥å£ï¼š**æ¯å°æ—¶åªèƒ½è°ƒç”¨1æ¬¡**
- `daily` æ¥å£ï¼šæ¯åˆ†é’Ÿè°ƒç”¨æ¬¡æ•°æœ‰é™åˆ¶
- é¢‘ç¹è°ƒç”¨ä¼šè¢«é™åˆ¶è®¿é—®

**è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… æ•°æ®å­˜å‚¨åˆ°MySQLæ•°æ®åº“
- âœ… ä¼˜å…ˆä»æ•°æ®åº“è¯»å–
- âœ… æ•°æ®åº“æ²¡æœ‰æ—¶æ‰ä»Tushareè·å–
- âœ… æ”¯æŒæ‰‹åŠ¨åŒæ­¥æ›´æ–°

---

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### 1. è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯è¡¨ (`stock_basic`)

**å·²å­˜åœ¨çš„è¡¨**:
```sql
CREATE TABLE stock_basic (
    ts_code VARCHAR(20) PRIMARY KEY COMMENT 'TSä»£ç ',
    symbol VARCHAR(20) COMMENT 'è‚¡ç¥¨ä»£ç ',
    name VARCHAR(100) COMMENT 'è‚¡ç¥¨åç§°',
    area VARCHAR(100) COMMENT 'åœ°åŸŸ',
    industry VARCHAR(100) COMMENT 'æ‰€å±è¡Œä¸š',
    list_date DATE COMMENT 'ä¸Šå¸‚æ—¥æœŸ'
);
```

**ç”¨é€”**ï¼š
- å­˜å‚¨æ‰€æœ‰Aè‚¡ä¸Šå¸‚å…¬å¸åŸºæœ¬ä¿¡æ¯
- æ”¯æŒæŒ‰è¡Œä¸šã€åœ°åŸŸç­›é€‰
- çº¦5000æ¡æ•°æ®

---

### 2. æ—¥çº¿æ•°æ®è¡¨ (`stock_daily_history`)

**å·²å­˜åœ¨çš„è¡¨**:
```sql
CREATE TABLE stock_daily_history (
    ts_code VARCHAR(20) COMMENT 'è‚¡ç¥¨ä»£ç ',
    trade_date VARCHAR(8) COMMENT 'äº¤æ˜“æ—¥æœŸYYYYMMDD',
    open DECIMAL(10,2) COMMENT 'å¼€ç›˜ä»·',
    high DECIMAL(10,2) COMMENT 'æœ€é«˜ä»·',
    low DECIMAL(10,2) COMMENT 'æœ€ä½ä»·',
    close DECIMAL(10,2) COMMENT 'æ”¶ç›˜ä»·',
    pre_close DECIMAL(10,2) COMMENT 'æ˜¨æ”¶ä»·',
    change DECIMAL(10,2) COMMENT 'æ¶¨è·Œé¢',
    pct_chg DECIMAL(10,2) COMMENT 'æ¶¨è·Œå¹…%',
    vol BIGINT COMMENT 'æˆäº¤é‡',
    amount DECIMAL(20,2) COMMENT 'æˆäº¤é¢',
    PRIMARY KEY (ts_code, trade_date)
);
```

**ç”¨é€”**ï¼š
- å­˜å‚¨è‚¡ç¥¨æ¯æ—¥Kçº¿æ•°æ®
- ç”¨äºå›¾è¡¨å±•ç¤º
- çº¦5000åªè‚¡ç¥¨ Ã— 250å¤©/å¹´ = 125ä¸‡æ¡/å¹´

---

## ğŸ”„ æ•°æ®ç¼“å­˜é€»è¾‘

### æµç¨‹å›¾

```
å‰ç«¯è¯·æ±‚è‚¡ç¥¨åˆ—è¡¨
      â†“
   æŸ¥è¯¢æ•°æ®åº“
      â†“
  æœ‰æ•°æ®ï¼Ÿ â”€â†’ æ˜¯ â”€â†’ è¿”å›æ•°æ®åº“æ•°æ®
      â†“
     å¦
      â†“
è°ƒç”¨Tushare API
      â†“
  ä¿å­˜åˆ°æ•°æ®åº“
      â†“
   è¿”å›æ•°æ®
```

---

## ğŸš€ æ–°å¢APIæ¥å£

### 1. è·å–è‚¡ç¥¨åˆ—è¡¨ï¼ˆå¸¦ç¼“å­˜ï¼‰

**æ¥å£**: `GET /api/stocks`

**å‚æ•°**:
- `industry`: è¡Œä¸šç­›é€‰ï¼ˆå¯é€‰ï¼‰
- `area`: åœ°åŸŸç­›é€‰ï¼ˆå¯é€‰ï¼‰
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `page_size`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤50ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": [...],
  "total": 5000,
  "page": 1,
  "page_size": 50,
  "total_pages": 100,
  "source": "database"
}
```

**ç¼“å­˜é€»è¾‘**:
1. ä¼˜å…ˆä»æ•°æ®åº“æŸ¥è¯¢
2. å¦‚æœæ•°æ®åº“ä¸ºç©ºï¼Œè‡ªåŠ¨è°ƒç”¨TushareåŒæ­¥
3. åŒæ­¥åå†æ¬¡æŸ¥è¯¢æ•°æ®åº“
4. `source`å­—æ®µè¡¨æ˜æ•°æ®æ¥æº

---

### 2. æ‰‹åŠ¨åŒæ­¥è‚¡ç¥¨åˆ—è¡¨

**æ¥å£**: `POST /api/stocks/sync`

**è¯·æ±‚ä½“**:
```json
{
  "force_update": false
}
```

**å‚æ•°è¯´æ˜**:
- `force_update`: æ˜¯å¦å¼ºåˆ¶æ›´æ–°ï¼ˆé»˜è®¤falseï¼‰
  - `false`: æ•°æ®åº“æœ‰æ•°æ®åˆ™è·³è¿‡
  - `true`: å¼ºåˆ¶ä»Tushareé‡æ–°è·å–

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "åŒæ­¥æˆåŠŸ",
  "added": 100,
  "updated": 4900,
  "total": 5000,
  "source": "tushare"
}
```

**ä½¿ç”¨åœºæ™¯**:
- é¦–æ¬¡ä½¿ç”¨ç³»ç»Ÿæ—¶è°ƒç”¨ä¸€æ¬¡
- æ¯å‘¨/æ¯æœˆæ›´æ–°ä¸€æ¬¡è‚¡ç¥¨åˆ—è¡¨
- å‘ç°æ–°è‚¡ä¸Šå¸‚æ—¶

---

### 3. è·å–æ—¥çº¿æ•°æ®ï¼ˆå¸¦ç¼“å­˜ï¼‰

**æ¥å£**: `GET /api/stocks/{ts_code}/daily`

**å‚æ•°**:
- `start_date`: å¼€å§‹æ—¥æœŸ YYYYMMDDï¼ˆå¯é€‰ï¼‰
- `end_date`: ç»“æŸæ—¥æœŸ YYYYMMDDï¼ˆå¯é€‰ï¼‰
- `limit`: è¿”å›æ¡æ•°ï¼ˆé»˜è®¤60ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "ts_code": "000001.SZ",
      "trade_date": "20230930",
      "open": 12.50,
      "high": 12.80,
      "low": 12.45,
      "close": 12.75,
      "pct_chg": 2.00,
      "vol": 150000,
      "amount": 187500
    }
  ],
  "source": "database"
}
```

**ç¼“å­˜é€»è¾‘**:
1. ä¼˜å…ˆä»æ•°æ®åº“æŸ¥è¯¢
2. å¦‚æœæ•°æ®åº“ä¸ºç©ºï¼Œè‡ªåŠ¨è°ƒç”¨Tushareè·å–
3. ä¿å­˜åˆ°æ•°æ®åº“åè¿”å›

---

### 4. æ‰‹åŠ¨åŒæ­¥æ—¥çº¿æ•°æ®

**æ¥å£**: `POST /api/stocks/{ts_code}/daily/sync`

**è¯·æ±‚ä½“**:
```json
{
  "start_date": "20230901",
  "end_date": "20230930"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "åŒæ­¥æˆåŠŸ",
  "added": 20,
  "source": "tushare"
}
```

**ä½¿ç”¨åœºæ™¯**:
- è¡¥å……å†å²æ•°æ®
- æ›´æ–°æœ€æ–°äº¤æ˜“æ—¥æ•°æ®

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### åˆæ¬¡ä½¿ç”¨

**æ­¥éª¤1**: åŒæ­¥è‚¡ç¥¨åˆ—è¡¨
```bash
POST /api/stocks/sync
{
  "force_update": true
}
```

**æ­¥éª¤2**: å‰ç«¯æ­£å¸¸è°ƒç”¨
```bash
GET /api/stocks?page=1&page_size=50
```

ä»¥åæ‰€æœ‰è¯·æ±‚éƒ½ä¼šè‡ªåŠ¨ä»æ•°æ®åº“è¯»å–ï¼Œ**ä¸ä¼šå†è°ƒç”¨Tushare**ï¼

---

### æ—¥å¸¸ä½¿ç”¨

**è·å–è‚¡ç¥¨åˆ—è¡¨**:
```
GET /api/stocks?industry=é“¶è¡Œ
```
â†’ ç›´æ¥ä»æ•°æ®åº“è¯»å–ï¼Œç§’çº§å“åº” âš¡

**è·å–Kçº¿æ•°æ®**:
```
GET /api/stocks/000001.SZ/daily?limit=30
```
â†’ ç¬¬ä¸€æ¬¡ä¼šä»Tushareè·å–å¹¶ç¼“å­˜  
â†’ ä»¥åéƒ½ä»æ•°æ®åº“è¯»å– âš¡

---

### å®šæœŸæ›´æ–°

**æ¯å‘¨æ›´æ–°è‚¡ç¥¨åˆ—è¡¨**ï¼ˆæ–°è‚¡ä¸Šå¸‚ï¼‰:
```bash
POST /api/stocks/sync
{
  "force_update": true
}
```

**æ¯æ—¥æ›´æ–°Kçº¿æ•°æ®**ï¼ˆå¯é€‰ï¼Œå®šæ—¶ä»»åŠ¡ï¼‰:
```bash
POST /api/stocks/000001.SZ/daily/sync
{
  "start_date": "20230930",
  "end_date": "20230930"
}
```

---

## ğŸ¯ ä¼˜åŠ¿æ€»ç»“

### âœ… è§£å†³APIé™åˆ¶
- é¿å…é¢‘ç¹è°ƒç”¨Tushare
- ä¸å—æ¯å°æ—¶1æ¬¡çš„é™åˆ¶
- æ•°æ®å“åº”æ›´å¿«

### âœ… æå‡æ€§èƒ½
- æ•°æ®åº“æŸ¥è¯¢æ¯”APIè°ƒç”¨å¿«10å€ä»¥ä¸Š
- æ”¯æŒåˆ†é¡µã€ç­›é€‰
- æ”¯æŒSQLèšåˆæŸ¥è¯¢

### âœ… æ•°æ®æŒä¹…åŒ–
- å†å²æ•°æ®æ°¸ä¹…ä¿å­˜
- æ”¯æŒç¦»çº¿ä½¿ç”¨
- å¯ä»¥åšæ•°æ®åˆ†æ

### âœ… çµæ´»æ§åˆ¶
- å¯ä»¥é€‰æ‹©ä½•æ—¶æ›´æ–°
- æ”¯æŒå¼ºåˆ¶åˆ·æ–°
- æ”¯æŒæ‰¹é‡åŒæ­¥

---

## ğŸ“ ä¸‹ä¸€æ­¥å·¥ä½œ

### å¾…å®ç°åŠŸèƒ½

1. **å®šæ—¶ä»»åŠ¡**ï¼ˆAPSchedulerï¼‰
   - æ¯æ—¥æ”¶ç›˜åè‡ªåŠ¨æ›´æ–°Kçº¿æ•°æ®
   - æ¯å‘¨è‡ªåŠ¨æ›´æ–°è‚¡ç¥¨åˆ—è¡¨

2. **å¢é‡æ›´æ–°**
   - åªæ›´æ–°ç¼ºå¤±çš„æ—¥æœŸ
   - é¿å…é‡å¤æ•°æ®

3. **æ•°æ®æ¸…ç†**
   - å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®
   - å‹ç¼©å†å²æ•°æ®

4. **ç¼“å­˜ä¼˜åŒ–**
   - Redisç¼“å­˜çƒ­é—¨æ•°æ®
   - LRUæ·˜æ±°æœºåˆ¶

---

## ğŸ”§ æŠ€æœ¯å®ç°

### StockDataServiceæ ¸å¿ƒæ–¹æ³•

```python
class StockDataService:
    
    @staticmethod
    def get_stock_list(industry, area, page, page_size):
        """
        1. æŸ¥è¯¢æ•°æ®åº“
        2. å¦‚æœä¸ºç©ºï¼Œè°ƒç”¨sync_stock_list()
        3. è¿”å›åˆ†é¡µæ•°æ®
        """
    
    @staticmethod
    def sync_stock_list(force_update):
        """
        1. ä»Tushareè·å–æ•°æ®
        2. æ‰¹é‡æ’å…¥/æ›´æ–°æ•°æ®åº“
        3. è¿”å›åŒæ­¥ç»“æœ
        """
    
    @staticmethod
    def get_daily_data(ts_code, start_date, end_date, limit):
        """
        1. æŸ¥è¯¢æ•°æ®åº“
        2. å¦‚æœä¸ºç©ºï¼Œè°ƒç”¨sync_daily_data()
        3. è¿”å›å†å²æ•°æ®
        """
    
    @staticmethod
    def sync_daily_data(ts_code, start_date, end_date):
        """
        1. ä»Tushareè·å–æ•°æ®
        2. æ‰¹é‡æ’å…¥æ•°æ®åº“ï¼ˆå»é‡ï¼‰
        3. è¿”å›åŒæ­¥ç»“æœ
        """
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡åŒæ­¥éœ€è¦æ—¶é—´**
   - 5000åªè‚¡ç¥¨çº¦éœ€1-2åˆ†é’Ÿ
   - å»ºè®®åœ¨åå°è¿›è¡Œ

2. **APIé™åˆ¶ä»ç„¶å­˜åœ¨**
   - æ‰‹åŠ¨syncæ“ä½œä¼šè°ƒç”¨Tushare
   - ä¸è¦é¢‘ç¹æ‰‹åŠ¨åŒæ­¥
   - å»ºè®®æ¯å‘¨æœ€å¤š1æ¬¡

3. **æ•°æ®åº“ç©ºé—´**
   - è‚¡ç¥¨åˆ—è¡¨ï¼šçº¦1MB
   - æ—¥çº¿æ•°æ®ï¼šçº¦100MB/å¹´
   - æ€»è®¡ä¸ä¼šè¶…è¿‡500MB

4. **æ•°æ®ä¸€è‡´æ€§**
   - æ•°æ®åº“æ•°æ®å¯èƒ½æœ‰å»¶è¿Ÿ
   - é‡è¦å†³ç­–å»ºè®®æ‰‹åŠ¨syncç¡®è®¤

---

**å®Œæˆæ—¶é—´**: 2025å¹´9æœˆ30æ—¥  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… å·²å®ç°
